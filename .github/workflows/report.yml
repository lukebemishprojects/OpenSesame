{
    "name": "Report Test Results",
    "on": {
        "workflow_run": {
            "types": [
                "completed"
            ],
            "workflows": [
                "Build PR",
                "Snapshot"
            ]
        }
    },
    "jobs": {
        "checks": {
            "runs-on": "ubuntu-22.04",
            "steps": [
                {
                    "name": "Checkout",
                    "uses": "actions/checkout@v4",
                    "with": {
                        "ref": "${{ github.event.workflow_run.head_commit.id }}",
                        "repository": "${{ github.event.workflow_run.head_repository.full_name }}"
                    }
                },
                {
                    "name": "Download Gradle Test Report",
                    "id": "download-gradle",
                    "uses": "actions/download-artifact@v4",
                    "with": {
                        "name": "junit-test-results-gradle",
                        "path": "gradle",
                        "github-token": "${{ github.token }}",
                        "run-id": "${{ github.event.workflow_run.id }}"
                    }
                },
                {
                    "name": "JUnit Test Report - Transformation",
                    "uses": "dorny/test-reporter@v1",
                    "if": "(success() || failure()) && steps.download-gradle.outcome == 'success'",
                    "with": {
                        "name": "Test Results - Transformation",
                        "path": "gradle/**/TEST-*.xml",
                        "reporter": "java-junit",
                        "fail-on-empty": "true",
                        "list-tests": "failed"
                    }
                },
                {
                    "name": "Download Platform Test Report",
                    "id": "download-platform",
                    "uses": "actions/download-artifact@v4",
                    "if": "(success() || failure())",
                    "with": {
                        "name": "junit-test-results-platform",
                        "path": "platform",
                        "github-token": "${{ github.token }}",
                        "run-id": "${{ github.event.workflow_run.id }}"
                    }
                },
                {
                    "name": "JUnit Test Report - Metafactory",
                    "uses": "dorny/test-reporter@v1",
                    "if": "(success() || failure()) && steps.download-platform.outcome == 'success'",
                    "with": {
                        "name": "Test Results - Metafactory",
                        "path": "platform/**/TEST-*.xml",
                        "reporter": "java-junit",
                        "fail-on-empty": "true",
                        "list-tests": "failed"
                    }
                }
            ],
            "permissions": {
                "contents": "read",
                "actions": "read",
                "checks": "write"
            }
        }
    }
}